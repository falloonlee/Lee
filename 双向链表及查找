#include "stdio.h"
#include "string.h"
#include "stdlib.h"
#include "time.h"
struct lianbiao 
{
  int hour;//时
  int min;//分
  int sec;//秒
  int sex; //性别
  struct lianbiao *front; //前驱指针
  struct lianbiao *back;// 后驱指针
};
viod get(char mn[10]) //获取输入字符。
{
  char *pm;
  pm=mn;
  printf("请输入需要查找的人的姓名");
  while(1)
  {
    *pm=getchar();
    if(*pm=='\n') //检测到回车
      {
        *pm='\0'; //把回车替换成字符串终止符然后跳出
        break;
      }
      pm++;
  }
}
struct lianbiao *find(char mn[10],struct lianbiao *Head,struct lianbiao *p)//定义查找链表函数
{
  p=Head->back;
  do
  {
    if(strcmp(p->name,mn)) //判断name字段是否与给定的字符串一致
    {
      return p;    //一致则返回此刻p指向的地址
    }
    p=p->back; //不一致指向下一个地址继续循环
  }while(p->back!=Head->back); //当循环完毕后跳出
  return NULL;  //循环完毕都不能找到给定字符串 反馈地址为空。
  }
  int nun(int nos[2],struct lianbiao *Head,struct lianbiao *p)
  {
    p=Head->back;    
    do
    {
      if(p->sex)//sex 非0时 为男性
        nos[1]++; //男性人数加1
      else
        nos[0]++; // 女性人数加1
    }while(p->back!=Head->back);
    return nos;
  }
  
  int main()
  {
  int nos[2]={0};
  char mn[10]={0};
  time_t t;
  struct tm *tnow;  
  //—————————————————————————————————双向链表创建开始—————————————————————————————————————//
  struct lianbiao *Head,*p,*Tail;  //定制链表结构指针
  Head=p=Tail=calloc(1,sizeof(struct lianbiao)); //初始化指针地址
  do  //do while 赋值
  {
  Tail=calloc(1,sizeof(struct lianbiao));//初始化Tail指针
  printf("请输入签到人的姓名与性别：性别0为女性，1为男性。\n");
  scanf("%s %d",Tail->name,Tail->sex);//获取姓名 和性别 已空格隔开
  gechar();
  time(&t);//获取本地时间
  tnow=localtime(&t); //获取本地时间
  Tail->hour=tnow->hour;  //时间赋值
  Tail->min=tnow->min;  // 分赋值
  Tail->sec=tnow->sec;  //秒赋值
  Tail->front=p;    // 当前地址前驱变为上一个地址p
  p->back=Tail;   // 上一个地址的前驱变为当前地址
  p=Tail;    //最后 吧上一个地址变更 为当前地址。
  }while(Tail->name!="exit");
  Tail->back=Head;//双向链表 尾部的后一个地址指向头部
  Head->front=Tail;//双向链表，头部的前一个地址指向尾部
  //—————————————————————————————————双向链表创建成功—————————————————————————————————————//
  get(mn);
  p=find(mn,Head,p);
  if(p->sex!=0)
    printf("查询到%s性别男的签到时间是：%d:%d:%d\n",p->name,p->hour,p->min,p->sec);
  else
    printf("查询到%s性别女的签到时间是：%d:%d:%d\n",p->name,p->hour,p->min,p->sec);
  nun(nos,Head,p);
  printf("查询到男性共计%d位，女性%d位",nos[1],nos[0]);
  /*
  get(mn);
  Head=p=find(mn,Head,p);
  do{
  if(p->sex!=0)
    printf("查询到%s性别男的签到时间是：%d:%d:%d\n",p->name,p->hour,p->min,p->sec);
  else
    printf("查询到%s性别女的签到时间是：%d:%d:%d\n",p->name,p->hour,p->min,p->sec);
  p=p->front;
  }while(p->front!=Head->front);
  */
  return 0;
  }
